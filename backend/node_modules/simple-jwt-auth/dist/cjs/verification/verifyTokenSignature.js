"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifyTokenSignature = void 0;
const getUnauthedHeaderClaims_1 = require("../getUnauthedHeaderClaims");
const isSignatureVerified_1 = require("../signingAlgorithm/isSignatureVerified");
const JwtVerificationError_1 = require("./JwtVerificationError");
/**
 * asserts that a token's signature is verified for its claims
 */
const verifyTokenSignature = ({ token, publicKey, }) => {
    // determine if signature is verified
    const { alg } = (0, getUnauthedHeaderClaims_1.getUnauthedHeaderClaims)({ token });
    const payload = token.split('.').slice(0, 2).join('.'); // drop the signature
    const signature = token.split('.').slice(-1)[0]; // signature is the last el
    const verified = (0, isSignatureVerified_1.isSignatureVerified)({ alg, signature, payload, publicKey });
    // throw an error if its not
    if (!verified)
        throw new JwtVerificationError_1.JwtVerificationError({ reason: 'signature is wrong' });
};
exports.verifyTokenSignature = verifyTokenSignature;
//# sourceMappingURL=verifyTokenSignature.js.map